<h1 class="better-num"><%= "訂單 ##{@order.num}" %></h1>
<div class="clearfix"></div>
<div class="table-like-columns">
  <div class="col-xs-12 tr">
    <div class="col-xs-3 thead">
      <h5>訂購時間</h5>
    </div>
    <div class="col-xs-9 tbody">
      <p><%= @order.order_time %></p>
    </div>
  </div>
  <div class="col-xs-12 tr">
    <div class="col-xs-3 thead">
      <h5>訂購者</h5>
    </div>
    <div class="col-xs-9 tbody">
      <p><%= @order.user.name %></p>
    </div>
  </div>
  <div class="col-xs-12 tr">
    <div class="col-xs-12 thead">
      <h5>訂單內容</h5>
    </div>
    <%= form_for @order, url: order_path(@order.token) do |f| %>
      <div class="clearfix" id="items_in_list">
        <%= f.fields_for :order_items do |ff| %>
        <div class="col-xs-12 item">
          <div class="col-xs-3 col-sm-3">
            <% if ff.object.product.attachments_count > 0 %>
              <%= link_to ff.object.product do %>
                <%= image_tag ff.object.product.attachments.first.image.url, class: "img100" %>
              <% end %>
            <% end %>
          </div>
          <div class="col-xs-9 col-sm-4">
            <%= link_to "#{ff.object.product.name}#{(' (' + ff.object.variation.jp_name + ')') if ff.object.variation.present?}", ff.object.product %><br>
            <%= ff.object.price %> x
            <% if @order.cancelable? %>
              <%= ff.number_field :quantity, { style: "width: 60px; margin: 10px 0px;", max: 999, pattern: "[0-9]*" } %><br>
              <div class="no-space">
                <%= f.submit "更新", class: "btn btn-primary", style: "width: 33.33%;" %>
                <%= link_to "下次再買", root_path, class: "btn btn-link", style: "width: 33.33%;" %>
                <% if @order.cancelable? %>
                  <%= link_to order_item_path(ff.object), method: :delete, data: { confirm: "從訂單移除#{ff.object.name}?" }, class: "btn btn-link", style: "width: 33.33%" do %>
                    <i class="glyphicon glyphicon-remove"></i>
                    刪除
                  <% end %>
                <% end %>
              </div>
            <% else %>
              <%= ff.object.quantity %>
            <% end %>
          </div>
        </div>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="col-xs-12">
    <div class="col-xs-3"></div>
    <div class="col-xs-9 text-right text-danger" style="font-size: 24px;"><strong><%= "NT #{@order.total} 元" %></strong></div>
  </div>
  <div class="col-xs-12">
    <div class="col-xs-3"></div>
    <div class="col-xs-9 text-right"><%= @order.i18n_state_for_user %></div>
  </div>
  <div class="col-xs-12 text-center" style="margin-top: 30px;">
    <%= render_order_state_btns(@order) %>
    <%= contact_us %>
  </div>
</div>
<script type="text/javascript">
  $("input[id*='_quantity']").bind('keypress change', function(){
    $(this).siblings("input[type='submit']").removeClass("hidden")
  })
</script>